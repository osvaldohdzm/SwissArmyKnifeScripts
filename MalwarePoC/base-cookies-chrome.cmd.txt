@echo off
setlocal enabledelayedexpansion

set "chrome_dir=%LOCALAPPDATA%\Google\Chrome\User Data\Default\Network"
set "output_file=cookies.txt"

if not exist "%chrome_dir%" (
    echo Chrome user data directory not found.
    exit /b
)

if exist "%output_file%" (
    del "%output_file%"
)

set "temp_file=%TEMP%\chrome_cookies.tmp"
set "sql_query=SELECT host_key, is_secure, path, expires_utc, name, encrypted_value FROM cookies"

echo Exporting Chrome cookies...

:: Extract cookies to a temporary file
sqlite3 "%chrome_dir%\Cookies" "%sql_query%;" > "%temp_file%"

echo # Netscape HTTP Cookie File > "%output_file%"
echo # http://curl.haxx.se/rfc/cookie_spec.html >> "%output_file%"
echo # This is a generated file! Do not edit. >> "%output_file%"
echo. >> "%output_file%"
echo # Domain    Subdomain   Path    Secure    Expire    Name    Value >> "%output_file%"

:: Read the cookies and format them in Netscape format
for /F "tokens=1-6 delims=|" %%A in ('type "%temp_file%"') do (
    set "domain=%%A"
    set "subdomain=TRUE"
    set "secure=TRUE"
    set "path=%%C"
    set "expiration=%%D"
    set "name=%%E"
    set "encrypted_value=%%F"

    :: Decrypt the encrypted_value using the decryption algorithm and encryption key
    REM TODO: Add your decryption code here to decrypt the encrypted_value

    echo !domain!    !subdomain!    !path!    !secure!    !expiration!    !name!    DECRYPTED_VALUE >> "%output_file%"
)

del "%temp_file%"

echo Export completed. Cookies exported to "%output_file%".

:: Show the value of Encrypted Key
set "filename=%LOCALAPPDATA%\Google\Chrome\User Data\Local State"
set "json_key=os_crypt"
set "value_key=encrypted_key"

for /f "usebackq tokens=*" %%A in (`C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -Command "Get-Content -Raw '%filename%' | ConvertFrom-Json | Select-Object -ExpandProperty %json_key% | Select-Object -ExpandProperty %value_key%"`) do (
  set "encrypted_key=%%~A"
)

echo Encrypted Key: %encrypted_key%
exit /b
